---
layout: post
category: tech
---

最近因为毕业设计的项目需要一个远程检查，所以老师让我把毕业设计部署到服务器上，然后让我联系一个买了阿里云服务器的学长，学长的阿里云上已经有docker了，所以记录一下将项目用docker部署到阿里云上的过程：

---

# 目录
- [ssh连接](#ssh连接)
- [neo4j数据库](#neo4j数据库)
- [MySQL数据库](#mysql数据库)
- [部署后端](#部署后端)
- [后端部署的bug](#后端部署的bug)

---

# [ssh连接](#ssh连接)

ssh连接主要使用的是Xshell的教育版，官网的下载地址是这个：

[Xshell官网下载地址](https://www.netsarang.com/zh/free-for-home-school/)

教程主要参考的下面这个，由于我的账户密码是学长给的，所以参考的就是后半部分的连接部分：

[Xshell教程](https://zhuanlan.zhihu.com/p/54643053)

按照教程连接对应的主机时，会要求输入对应的账户名和密码，同时分配账户的人还可以设置各个账户的权限，我发现我这个账户就没有root权限。

![Xshell的身份验证](/img/20210421/xshell的身份验证.png)
<center>Xshell的身份验证</center>

---

# [neo4j数据库](#neo4j数据库)

neo4j数据库为了保证兼容性，达到和在自己电脑上一致的运行效果，首先查看自己电脑上neo4j的版本信息：

![neo4j版本信息](/img/20210421/neo4j版本.png)

然后参考这两篇博客部署neo4j：

[docker安装部署neo4j](https://www.cnblogs.com/caoyusang/p/13610408.html)

[Centos下Docker中运行neo4j 并配置挂载本地文件](https://www.cnblogs.com/baiyunwanglai/p/10281694.html)

首先使用

>docker pull neo4j:[对应版本号]

的命令下载对应的neo4j版本：

![下载neo4j对应版本](/img/20210421/下载对应neo4j版本.png)

然后输入对应的语句配置和启动neo4j:

![配置和启动neo4j](/img/20210421/neo4j配置和启动.png)

	docker run -d --name container_name \  //-d表示容器后台运行 --name指定容器名字
	-p 7474:7474 -p 7687:7687 \  //映射容器的端口号到宿主机的端口号
	-v /home/neo4j/data:/data \  //把容器内的数据目录挂载到宿主机的对应目录下
	-v /home/neo4j/logs:/logs \  //挂载日志目录
	-v /home/neo4j/conf:/var/lib/neo4j/conf   //挂载配置目录
	-v /home/neo4j/import:/var/lib/neo4j/import \  //挂载数据导入目录
	--env NEO4J_AUTH=neo4j/password \  //设定数据库的名字的访问密码
	neo4j:version //指定使用的镜像对应版本号

最后通过客户端的浏览器查看访问对应端口验证是否设置成功：

![浏览器验证neo4j](/img/20210421/验证neo4j.png)

---

# [MySQL数据库](#mysql数据库)

首先还是查看MySQL的版本：

![MySQL版本](/img/20210421/mysql版本.png)

然后主要参照这个博客部署MySQL：

[在docker中运行mysql实例](https://www.cnblogs.com/chywx/p/10528040.html)

但是这个教程中修改文件位置会报错，原因应该是默认配置文件的位置发生了变化：

[Docker安装MySQL](https://www.runoob.com/docker/docker-install-mysql.html)

之后的过程与下载和配置noe4j类似：

![下载MySQL](/img/20210421/下载mysql.png)
<center>下载MySQL</center>

![运行MySQL](/img/20210421/运行mysql.png)
<center>运行MySQL</center>

---

# [部署后端](#部署后端)

参考了这些博客部署SpringBoot的项目：

[使用docker将SpringBoot项目部署到阿里云](https://blog.csdn.net/weixin_43691723/article/details/108430980)

首先，需要将SpringBoot项目打包：

![项目打包](/img/20210421/springboot项目打包.png)
<center>项目打包</center>

![打包成功](/img/20210421/打包成功.png)
<center>打包成功</center>

然后需要将打包后的jar包发送到服务器上，这时候就需要使用工具发送，我使用的是Xftp

[Xftp官方下载地址](https://www.netsarang.com/zh/free-for-home-school/)

Xftp支持图形化界面操作，新建一个传输连接之后，创建对应目录拖动即可

![新建文件传输](/img/20210421/新建文件传输.png)
<center>新建文件传输</center>

![xftp操作](/img/20210421/xftp操作.png)
<center>xftp操作</center>

之后需要使用vim编辑一个配置文件：

[vim使用教程](https://www.runoob.com/linux/linux-vim.html)

![后端配置](/img/20210421/后端配置.png)
<center>后端配置</center>

之后悲催的发现jdk11没有官方的docker镜像，为了保证版本兼容，先找一个靠谱的第三方jdk11的镜像：

[jdk镜像](http://www.sousou88.com/spec/oraclejdk.html)

然后需要制作一个jdk11的docker镜像，这里参考了这两个博客：

[自己制作一个java:11的docker镜像](https://blog.csdn.net/hongtaolong/article/details/106816920)

[docker基础镜像ubuntu添加jdk1.8](https://www.cnblogs.com/xiaoyao-001/p/12016156.html)

![jdk镜像配置](/img/20210421/jdk镜像配置.png)
<center>jdk镜像配置</center>

然后使用构建语句：

	docker build -t java:11 .

构建镜像（注意后面那个点不要少了，表示在当前路径构建）

![构建jdk镜像](/img/20210421/构建jdk镜像.png)

![测试jdk](/img/20210421/测试jdk.png)
<center>测试jdk</center>

完成之后再次构建后端镜像就成功了：

![构建后端镜像](/img/20210421/构建后端.png)

最后运行后端的镜像：

![后端运行](/img/20210421/后端运行.png)

---

# [后端部署的bug]()
当事情显得过于顺利的时候，往往就是坎坷