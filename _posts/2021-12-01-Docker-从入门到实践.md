---
layout: post
category: star
title: Docker 从入门到实践
---

最近在看 CI/CD 的相关的东西，需要先看 Docker 的相关概念，稍微记一下。

### [Docker 从入门到实践](https://yeasy.gitbook.io/docker_practice/introduction/what)

Docker 技术基于**容器**这个概念，指对进程进行封装隔离，属于操作系统层面的虚拟化技术。隔离的进程独立于宿主和其它的隔离的进程。

Docker 在容器的基础上，进行了进一步的封装，从文件系统、网络互联到进程隔离等等，极大的简化了容器的创建和维护。使得 Docker 技术比虚拟机技术更为轻便、快捷。

<img src="../img/2021-12-01-Docker-从入门到实践/截屏2021-12-01 上午11.29.21.png" style="zoom: 50%;" />

按照这个[说明](https://www.runoob.com/docker/windows-docker-install.html)，windows 运行 Docker 还需要安装一个虚拟机，所以可以简单理解为 Docker 就是复用了一下 Linux 的内核，单独构造不同的用户空间。

---

## 镜像（Image）

操作系统分为内核和用户空间。对于 Linux 而言，内核启动后，会挂载 root 文件系统为其提供用户空间支持。而 Docker 镜像（Image），就相当于是一个 root 文件系统。比如官方镜像 ubuntu:18.04 就包含了完整的一套 Ubuntu 18.04 最小系统的 root 文件系统。

Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像**不包含**任何动态数据，其内容在构建之后也不会被改变。

镜像构建时，会一层层构建，前一层是后一层的基础。每一层构建完就不会再发生改变，后一层上的任何改变只发生在自己这一层。比如，删除前一层文件的操作，实际不是真的删除前一层的文件，而是仅在当前层标记为该文件已删除。在最终容器运行的时候，虽然不会看到这个文件，但是实际上该文件会一直跟随镜像。因此，在构建镜像的时候，需要额外小心，每一层尽量只包含该层需要添加的东西，任何额外的东西应该在该层构建结束前清理掉。

分层存储的特征还使得镜像的复用、定制变的更为容易。甚至可以用之前构建好的镜像作为基础层，然后进一步添加新的层，以定制自己所需的内容，构建新的镜像。

---

## 容器（Container）

镜像（Image）和容器（Container）的关系，就像是面向对象程序设计中的 类 和 实例 一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。

每一个容器运行时，是以镜像为基础层，在其上创建一个当前容器的存储层，我们可以称这个为容器运行时读写而准备的存储层为 **容器存储层**。

按照 Docker 最佳实践的要求，容器不应该向其存储层内写入任何数据，容器存储层要保持无状态化。所有的文件写入操作，都应该使用数据卷（Volume）、或者绑定宿主目录，在这些位置的读写会跳过容器存储层，直接对宿主（或网络存储）发生读写，其性能和稳定性更高。

---

## 仓库（Repository）

镜像构建完成后，可以很容易的在当前宿主机上运行，但是，如果需要在其它服务器上使用这个镜像，我们就需要一个集中的存储、分发镜像的服务。

---

## 基本架构

Docker 采用了 C/S 架构，包括客户端和服务端。Docker 守护进程 （Daemon）作为服务端接受来自客户端的请求，并处理这些请求（创建、运行、分发容器）。

<img src="../img/2021-12-01-Docker-从入门到实践/截屏2021-12-01 下午1.10.53.png" style="zoom:50%;" />

---

## 命名空间

命名空间是 Linux 内核一个强大的特性。每个容器都有自己单独的命名空间，运行在其中的应用都像是在独立的操作系统中运行一样。命名空间保证了容器之间彼此互不影响。

Linux 为进程、网络、进程间通信，目录，主机域，用户等提供了不同的创建单独命名空间的抽象。

[不同的命名空间](https://yeasy.gitbook.io/docker_practice/underly/namespace)

---

## 控制组

控制组（cgroups）是 Linux 内核的一个特性，主要用来对共享资源进行隔离、限制、审计等。只有能控制分配到容器的资源，才能避免当多个容器同时运行时的对系统资源的竞争。
控制组技术最早是由 Google 的程序员在 2006 年提出，Linux 内核自 2.6.24 开始支持。
控制组可以提供对容器的内存、CPU、磁盘 IO 等资源的限制和审计管理。

---

## 联合文件系统

[Docker技术原理之Linux UnionFS（容器镜像)](https://www.jianshu.com/p/3ba255463047)

这里我的理解就是首先是将文件分层，然后达到很多容器可以共用一个在系统上的目录的目的，封层、共享、增量式是我认为的主要的几个特点。
